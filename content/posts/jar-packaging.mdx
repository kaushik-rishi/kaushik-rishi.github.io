---
title: "JAR Packaging and more on Maven depndencies"
publishedDate: "2024-6-1"
lastUpdatedDate: "2024-6-1"
status: published
series:
  order: 2
  title: "spring"
---

# Jar Packaging

> Not in context of this article but [Nice getting started guides](https://spring.io/guides/gs)

## Resources
- [git repo - maven setup from scratch](github.com/kaushik-rishi/mvn-basics)
- [Java classpath tutorial (ClassLoader, NoClassDefFoundError, JVM, javac, javap -c, java -cp, jar cvf)](https://www.youtube.com/watch?v=o_MouGNA1AE&t=253s)

## Maven project setup
>  Spring getting started guide and it's notes

- https://spring.io/guides/gs/maven (a more refined version - https://medium.com/@dmaioni/build-java-projects-with-maven-af269165727e)
- More pointers apart from the article
  - From `pom.xml`
    - `groupId` - website domain in reverse - insignificant
    - `executions[0].configuration.transformers[0].mainClass` - will add the main class (`Main-Class`) to `META-INF/MANIFEST.MF` file
  - `mvn compile` - will generate the `target/` folder, genereate all the class files
    - Afted adding a dependency to `pom.xml`, ran the command `mvn dependency:resolve` which helped install the package (can also use `mvn dependency:list`) - [gpt-thread](https://chatgpt.com/share/f4af9ded-8058-4a54-ba3b-3cf812b9521b)
    - Running the classes generated by compile command
      - This works `java -cp target/classes hello.Hello` but not this `java -cp target/classes/hello Hello` - [reason](https://chatgpt.com/share/d3b2c920-af6e-43fd-8065-c675f144243c)
  - `mvn package` - creates the jar file and adds it to the `target/` folder
    - To run the jar `java -jar target/greeterservice-0.1.0.jar`
      - if no main-class is there run `java -cp target/greeterservice-0.1.0.jar hello.Hello`
  - AMAZING THING!! You can use maven to run a single class from the compiled classes using `mvn exec:java -Dexec.mainClass="hello.Hello"` adding a `-X` flag for debug output. 
  - `mvn exec:java -Dexec.mainClass="hello.Hello" -X` - makes everything better, you'll get a crazy verbose output ([full log](https://text.is/86X1Y))
  - for example
```
[DEBUG] Collected project classpath [/Users/kmanchukonda/personal/java-jar-basics/mvn-basics/target/classes]
[DEBUG] Adding to classpath : /Users/kmanchukonda/personal/java-jar-basics/mvn-basics/target/classes
[DEBUG] Adding project dependency artifact: joda-time to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-sdk to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-sdk-common to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-semconv to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-sdk-trace to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-sdk-metrics to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-sdk-logs to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-exporter-logging to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-api to classpath
[DEBUG] Adding project dependency artifact: opentelemetry-context to classpath
[DEBUG] joining on thread Thread[hello.Hello.main(),5,hello.Hello]
Starting to read file...
```

## Creating JAR and executing them
- [Notes about JAR and Main-class manifest](https://stackoverflow.com/questions/9689793/cant-execute-jar-file-no-main-manifest-attribute/9689877#9689877)
- Blogs about classpath and JAR building
  - [Back to the basics of Java ‚Äî Part 1: Classpath](https://medium.com/javarevisited/back-to-the-basics-of-java-part-1-classpath-47cf3f834ff)
  - [Back to the basics of Java ‚Äî Part 2: The JAR](https://medium.com/javarevisited/back-to-the-basics-of-java-part-2-the-jar-6e923685d571)
- in reference to #Maven-project-setup section, when i unzip the jar, it also had the `org/joda-time` depedency in it, then i went to my [standalonetelemetry](TODO: add github url post push here) and tried running similar, but packages weren't bundled into jar, then i discovered this piece of code in my `pom.xml`, the `maven-shade-plugin` was bundling all the packages together.
  - note: üí° when using maven shade plugin, you get 2 jars on `mvn clean install` - original jar and maven shade wala jar
  ```xml
  <build>
      <plugins>
          <plugin>
              <groupId>org.apache.maven.plugins</groupId>
              <artifactId>maven-shade-plugin</artifactId>
              <version>3.2.4</version>
              <executions>
                  <execution>
                      <phase>package</phase>
                      <goals>
                          <goal>shade</goal>
                      </goals>
                      <configuration>
                          <transformers>
                              <transformer
                                  implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                  <mainClass>hello.Hello</mainClass>
                              </transformer>
                          </transformers>
                      </configuration>
                  </execution>
              </executions>
          </plugin>
      </plugins>
  </build>
  ```
  - when i tried running the jar in standalonetelemetry project, it was erroring out saying that it didn't have the required dependencies, precisely below
```
 ‚ûú  standalonetelemetry java -cp target/standalonetelemetry-1.0-SNAPSHOT.jar com.mstracing.Main
Error: Unable to initialize main class com.mstracing.Main
Caused by: java.lang.NoClassDefFoundError: io/opentelemetry/sdk/trace/export/SpanExporter
```
  - but when i ran the shade generated jar, it just ran
  ```
  üêâ ‚ûú  mvn-basics git:(main) ‚úó java -jar target/greeterservice-0.1.0.jar            
  Starting to read file...
  Finished reading file.
  Jun 01, 2024 9:59:08 PM io.opentelemetry.exporter.logging.LoggingSpanExporter export
  INFO: 'readFile' : 1c264ef332185a7d4af226c9729c1553 1a55973be6435e5e INTERNAL [tracer: exampleTracer:] {}
  Starting computation...
  Finished computation.
  Jun 01, 2024 9:59:11 PM io.opentelemetry.exporter.logging.LoggingSpanExporter export
  INFO: 'performComputation' : 1c264ef332185a7d4af226c9729c1553 c717258552881d99 INTERNAL [tracer: exampleTracer:] {}
  Starting to write file...
  Finished writing file.
  Jun 01, 2024 9:59:12 PM io.opentelemetry.exporter.logging.LoggingSpanExporter export
  INFO: 'writeFile' : 1c264ef332185a7d4af226c9729c1553 57338e73f2f5346c INTERNAL [tracer: exampleTracer:] {}
  Jun 01, 2024 9:59:12 PM io.opentelemetry.exporter.logging.LoggingSpanExporter export
  INFO: 'process' : 1c264ef332185a7d4af226c9729c1553 da1473d8095f5eac INTERNAL [tracer: exampleTracer:] {}
  ```


## some notes about javac compilation
- Why do I not need to import modules from same/default package ? and what's with generating depedency class files when present in the same directory - [answer](https://chatgpt.com/share/fdcecba2-708e-47a4-ad66-70e577452985) ‚≠ê‚≠ê‚≠ê

### Extra Resources

- [adding sql connector driver - maven](https://www.youtube.com/watch?v=zlHXH6maOR0)
- [`mvn archetype:generate` to generate maven projects from templates](https://nuwanzen.medium.com/create-java-project-from-maven-a272c4cd9a4a)
- [more about maven phases](https://medium.com/@j2eeexpert2015/maven-for-java-developers-a-step-by-step-guide-to-setting-up-and-building-projects-59152d09f00c)
